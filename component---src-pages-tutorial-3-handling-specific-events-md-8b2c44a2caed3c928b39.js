"use strict";(self.webpackChunkcloudmanager_api_docs=self.webpackChunkcloudmanager_api_docs||[]).push([[5824],{18949:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return l},default:function(){return u}});var o=t(87462),a=t(45987),i=(t(28387),t(10498)),d=t(91515),r=t(88072);const p=["components"],l={},s={_frontmatter:l},c=d.Z;function u(e){let{components:n}=e,t=(0,a.Z)(e,p);return(0,i.mdx)(c,(0,o.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"tutorial-step-3---handling-specific-events"},"Tutorial Step 3 - Handling Specific Events"),(0,i.mdx)("p",null,"As seen in ",(0,i.mdx)("a",{parentName:"p",href:"1-a-basic-webhook.md"},"Step 1"),", webhooks can be registered for one or more events. Depending on the type of integration you are actually building with Cloud Manager, you will end up with a single webhook script which can handle multiple events in different ways. The event can be identified by using the combination of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"@type")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"xdmEventEnvelope:objectType")," values. A full list can be found on the ",(0,i.mdx)("a",{parentName:"p",href:"/cloudmanager-api-docs/guides/api-usage/receiving-events/"},"Receiving Events")," page. For this step in the tutorial, you're going to add a simple log statement when event being received is a Pipeline Execution Started event."),(0,i.mdx)("h2",{id:"updating-the-webhook"},"Updating the Webhook"),(0,i.mdx)("p",null,"Replace the ",(0,i.mdx)("inlineCode",{parentName:"p"},"app.post")," block with this code:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"app.post('/webhook', (req, res) => {\n  if (process.env.CLIENT_ID !== req.body.recipient_client_id) {\n    console.warn(`Unexpected client id. Was expecting ${process.env.CLIENT_ID} and received ${req.body.recipient_client_id}`)\n    res.status(400)\n    res.end()\n    return\n  }\n  res.set('Content-Type', 'text/plain')\n  res.send('pong')\n\n  const STARTED = 'https://ns.adobe.com/experience/cloudmanager/event/started'\n  const EXECUTION = 'https://ns.adobe.com/experience/cloudmanager/pipeline-execution'\n\n  const event = req.body.event\n\n  if (STARTED === event['@type'] &&\n       EXECUTION === event['xdmEventEnvelope:objectType']) {\n    console.log('received execution start event')\n  }\n})\n")),(0,i.mdx)("p",null,"Now when a Pipeline Execution Started event is received, the message ",(0,i.mdx)("inlineCode",{parentName:"p"},"received execution start event")," will be logged."),(0,i.mdx)("h2",{id:"running-the-updated-webhook"},"Running the Updated Webhook"),(0,i.mdx)("p",null,"If you are running the script locally, you'll need to stop and restart the node process. You don't need to restart ngrok. In fact, if you do restart ngrok, the URL will likely change and you'll need to go back into the ",(0,i.mdx)("a",{href:"https://developer.adobe.com/console/projects",target:"_new"},"Adobe Developer Console")," and update the Webhook URL."),(0,i.mdx)("p",null,"If you are running the script through Glitch, Glitch will restart automatically. If you don't want to update your existing Glitch project (or lost it), you can click the button below to start over."),(0,i.mdx)(r.Z,{projectName:"adobe-cloudmanager-api-tutorial-step3",mdxType:"Glitch"}),(0,i.mdx)("h2",{id:"next-step"},"Next Step"),(0,i.mdx)("p",null,"With all that done, you're ready to proceed to the next step. Continue to ",(0,i.mdx)("a",{parentName:"p",href:"4-getting-an-access-token.md"},"Step 4"),"."))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-tutorial-3-handling-specific-events-md-8b2c44a2caed3c928b39.js.map