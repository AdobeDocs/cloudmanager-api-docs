{"version":3,"file":"component---src-pages-tutorial-4-getting-an-access-token-md-dae35bfc50cf317e6e0d.js","mappings":"iTAOaA,EAAe,CAAC,EAKvBC,GAJgBC,EAIY,cAJJ,SAA6BC,GAEzD,OADAC,QAAQC,KAAK,aAAeH,EAAO,4EAC5BI,EAAAA,EAAAA,KAAA,MAASH,EAClB,GAHsBD,MAKtB,MAAMK,EAAc,CAClBP,gBAEIQ,EAAYC,EAAAA,EACH,SAASC,EAAUC,GAG/B,IAHgC,WACjCC,GAEDD,EADIR,GAAKU,EAAAA,EAAAA,GAAAF,EAAAG,GAER,OAAOR,EAAAA,EAAAA,KAACE,GAASO,EAAAA,EAAAA,GAAA,GAAKR,EAAiBJ,EAAK,CAAES,WAAYA,EAAYI,QAAQ,eAI5EV,EAAAA,EAAAA,KAAA,MACE,GAAM,+CAA6C,gDAErDA,EAAAA,EAAAA,KAAA,qbACAA,EAAAA,EAAAA,KAAA,wGAAkGA,EAAAA,EAAAA,KAAA,MAAIW,WAAW,KAAG,gBAAsB,kJAC1IX,EAAAA,EAAAA,KAACL,EAAW,CAACiB,MAAM,OAAOC,QAAQ,UAAUH,QAAQ,iBACpDV,EAAAA,EAAAA,KAAA,yFAAmFA,EAAAA,EAAAA,KAAA,KAAGW,WAAW,IAC7F,KAAQ,iFAA+E,cACpE,MACvBX,EAAAA,EAAAA,KAAA,MACE,GAAM,wCAAsC,yCAE9CA,EAAAA,EAAAA,KAAA,mDAA6CA,EAAAA,EAAAA,KAAA,cAAYW,WAAW,KAAG,aAA2B,MAAMX,EAAAA,EAAAA,KAAA,cAAYW,WAAW,KAAG,iBAA+B,MAAMX,EAAAA,EAAAA,KAAA,cAAYW,WAAW,KAAG,cAA4B,SAASX,EAAAA,EAAAA,KAAA,cAAYW,WAAW,KAAG,UAAwB,sDAAsDX,EAAAA,EAAAA,KAAA,cAAYW,WAAW,KAAG,QAAsB,2JAC9XX,EAAAA,EAAAA,KAAA,MACE,GAAM,uCAAqC,gBAC1BA,EAAAA,EAAAA,KAAA,cAAYW,WAAW,MAAI,kBAAgC,cAC9EX,EAAAA,EAAAA,KAAA,oLACAA,EAAAA,EAAAA,KAAA,YAAKA,EAAAA,EAAAA,KAAA,QAAMW,WAAW,MAClB,UAAa,uBAAqB,+oBAoBtCX,EAAAA,EAAAA,KAAA,MACE,GAAM,iDAA+C,kDAEvDA,EAAAA,EAAAA,KAAA,0EAAoEA,EAAAA,EAAAA,KAAA,cAAYW,WAAW,KAAG,WAAyB,+IACvHX,EAAAA,EAAAA,KAAA,YAAKA,EAAAA,EAAAA,KAAA,QAAMW,WAAW,MAClB,UAAa,uBAAqB,wOAStCX,EAAAA,EAAAA,KAAA,MACE,GAAM,+BAA6B,gCAErCA,EAAAA,EAAAA,KAAA,wOAAkOA,EAAAA,EAAAA,KAAA,KAAGc,KAAK,+CAA+CC,OAAO,QAAM,2BAAgC,iCACtUf,EAAAA,EAAAA,KAAA,mNACAA,EAAAA,EAAAA,KAACgB,EAAAA,EAAM,CAACC,YAAY,wCAAwCP,QAAQ,YACpEV,EAAAA,EAAAA,KAAA,MACE,GAAM,aAAW,cAEnBA,EAAAA,EAAAA,KAAA,uFAAiFA,EAAAA,EAAAA,KAAA,KAAGW,WAAW,IAC3F,KAAQ,8BAA4B,UACrB,KAGvB,CAEAP,EAAWc,gBAAiB,C","sources":["webpack://cloudmanager-api-docs/./src/pages/tutorial/4-getting-an-access-token.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport DefaultLayout from \"/home/runner/work/cloudmanager-api-docs/cloudmanager-api-docs/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nimport Glitch from \"../../components/glitch\";\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <h1 {...{\n      \"id\": \"tutorial-step-4---obtaining-an-access-token\"\n    }}>{`Tutorial Step 4 - Obtaining an Access Token`}</h1>\n    <p>{`The JSON object sent to the webhook is very minimal -- it largely consists of event metadata (e.g. the timestamp of the event) and a URL to either the pipeline execution. In general, the webhook implementation will need to call the Cloud Manager API to get additional information. In the case of this tutorial, the webhook is actually going to make two API calls for more information. That, however, is for the next step...`}</p>\n    <p>{`In this step, we're going to lay the groundwork for making those API calls by obtaining an `}<em parentName=\"p\">{`access token`}</em>{` which will be passed to the API for the purpose of authentication. Adobe I/O uses OAuth Server-to-Server credential to obtain access tokens.`}</p>\n    <InlineAlert slots=\"text\" variant=\"warning\" mdxType=\"InlineAlert\" />\n    <p>{`Note that obtaining access token using JSON Web Tokens (JWT) is deprecated. `}<a parentName=\"p\" {...{\n        \"href\": \"https://developer.adobe.com/developer-console/docs/guides/authentication/JWT/\"\n      }}>{`Learn More`}</a>{`.`}</p>\n    <h2 {...{\n      \"id\": \"setting-up-the-environment-variables\"\n    }}>{`Setting up the Environment Variables`}</h2>\n    <p>{`The access token is created using the `}<inlineCode parentName=\"p\">{`CLIENT_ID`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`CLIENT_SECRET`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`GRANT_TYPE`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`SCOPES`}</inlineCode>{` variables, so the first step is to make sure the `}<inlineCode parentName=\"p\">{`.env`}</inlineCode>{` file has all of these variable populated. You should have done this in Step 0, but if not (or if you are using Glitch), you will need to do this now.`}</p>\n    <h2 {...{\n      \"id\": \"writing-the-getaccesstoken-function\"\n    }}>{`Writing the `}<inlineCode parentName=\"h2\">{`getAccessToken`}</inlineCode>{` Function`}</h2>\n    <p>{`For clarity, it makes sense to organize obtaining the access token into a separate function. The function makes an API call to an IMS endpoint for fetching the token.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async function getAccessToken () {\n  const form = new FormData();\n  form.append('client_id', process.env.CLIENT_ID);\n  form.append('client_secret', process.env.CLIENT_SECRET);\n  form.append('grant_type', process.env.GRANT_TYPE);\n  form.append('scope', process.env.SCOPES);\n\n  const response = await fetch('https://ims-na1.adobelogin.com/ims/token/v3', {\n    'method': 'POST',\n    'headers': { 'Content-Type': 'application/x-www-form-urlencoded' },\n    'body': form\n  })\n  if (!response.ok) {\n    throw new Error('Failed to get access token');\n  }\n  const responseData = await response.json();\n  return responseData.access_token;\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"getting-the-access-token-in-the-webhook-route\"\n    }}>{`Getting the Access Token in the Webhook Route`}</h2>\n    <p>{`The access token is an asynchronous function so it returns a `}<inlineCode parentName=\"p\">{`Promise`}</inlineCode>{`. So logging of the access token (which is all we're doing in this step) has to be done in a closure invoked when the Promise is resolved:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`if (STARTED === event['@type'] &&\n      EXECUTION === event['xdmEventEnvelope:objectType']) {\n  console.log('received execution start event')\n  getAccessToken().then(accessToken => {\n    console.log(accessToken)\n  })\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"running-the-updated-webhook\"\n    }}>{`Running the Updated Webhook`}</h2>\n    <p>{`If you are running the script locally, you'll need to stop and restart the node process. You don't need to restart ngrok. In fact, if you do restart ngrok, the URL will likely change and you'll need to go back into the `}<a href=\"https://developer.adobe.com/console/projects\" target=\"_new\">{`Adobe Developer Console`}</a>{` and update the Webhook URL.`}</p>\n    <p>{`If you are running the script through Glitch, Glitch will restart automatically. If you don't want to update your existing Glitch project (or lost it), you can click the button below to start over.`}</p>\n    <Glitch projectName=\"adobe-cloudmanager-api-tutorial-step4\" mdxType=\"Glitch\" />\n    <h2 {...{\n      \"id\": \"next-step\"\n    }}>{`Next Step`}</h2>\n    <p>{`With all that done, you're ready to proceed to the next step. Continue to `}<a parentName=\"p\" {...{\n        \"href\": \"5-getting-the-execution.md\"\n      }}>{`Step 5`}</a>{`.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","InlineAlert","name","props","console","warn","mdx","layoutProps","MDXLayout","DefaultLayout","MDXContent","_ref","components","_objectWithoutProperties","_excluded","_extends","mdxType","parentName","slots","variant","href","target","Glitch","projectName","isMDXComponent"],"sourceRoot":""}