{"version":3,"file":"component---src-pages-tutorial-5-getting-the-execution-md-b37862f12c2fdaf4ccc1.js","mappings":"2SAOaA,EAAe,CAAC,EACvBC,EAAc,CAClBD,aAAAA,GAEIE,EAAYC,EAAAA,EACH,SAASC,EAAW,GAGhC,IAFDC,EAAU,EAAVA,WACGC,GAAK,YAER,OAAO,SAACJ,GAAS,UAAKD,EAAiBK,EAAK,CAAED,WAAYA,EAAYE,QAAQ,eAI5E,eACE,GAAM,4CAA0C,6CAElD,2LACA,eACE,GAAM,uBAAqB,wBAE7B,uDAAwC,cAAGC,KAAK,2CAA2CC,OAAO,QAAM,cAAmB,0FAC3H,qBAAK,iBAAMC,WAAW,MAClB,UAAa,iBAAe,8BAGhC,wFAAyE,uBAAYA,WAAW,KAAG,gBAA8B,qDAAqD,uBAAYA,WAAW,KAAG,gBAA8B,8EAC9O,oGACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBAAqB,2CAGtC,eACE,GAAM,0CAAwC,sBACvB,uBAAYA,WAAW,MAAI,eAA6B,cACjF,iRACA,uNACA,oBACE,eAAIA,WAAW,OAAK,uBAAYA,WAAW,MAAI,mBAAiC,6CAA6C,uBAAYA,WAAW,MAAI,mBAAiC,eACzL,eAAIA,WAAW,OAAK,uBAAYA,WAAW,MAAI,aAA2B,uCAAuC,uBAAYA,WAAW,MAAI,aAA2B,eACvK,eAAIA,WAAW,OAAK,uBAAYA,WAAW,MAAI,iBAA+B,kCAEhF,0FACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBAAqB,6UActC,eACE,GAAM,4CAA0C,uBACxB,uBAAYA,WAAW,MAAI,gBAA8B,cACnF,uIAAwH,uBAAYA,WAAW,KAAG,kBAAgC,4FAClL,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBAAqB,+JAOtC,eACE,GAAM,wCAAsC,yCAE9C,+CAAgC,uBAAYA,WAAW,KAAG,gBAA8B,0IAA0I,cAAGA,WAAW,IAC5O,KAAQ,yCAAuC,iBACzB,wEAC1B,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBAAqB,2UAYtC,eACE,GAAM,+BAA6B,gCAErC,iPAAkO,cAAGF,KAAK,+CAA+CC,OAAO,QAAM,2BAAgC,iCACtU,4NACA,SAAC,IAAM,CAACE,YAAY,wCAAwCJ,QAAQ,YACpE,eACE,GAAM,aAAW,cAEnB,gGAAiF,cAAGG,WAAW,IAC3F,KAAQ,4BAA0B,UACnB,KAGvB,CAEAN,EAAWQ,gBAAiB,C","sources":["webpack://cloudmanager-api-docs/./src/pages/tutorial/5-getting-the-execution.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport DefaultLayout from \"/home/runner/work/cloudmanager-api-docs/cloudmanager-api-docs/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nimport Glitch from \"../../components/glitch\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <h1 {...{\n      \"id\": \"tutorial-step-5---getting-execution-data\"\n    }}>{`Tutorial Step 5 - Getting Execution Data`}</h1>\n    <p>{`Now that we have an access token, we can use it to make API calls into Cloud Manager to get more information about the execution (and in the next step the program).`}</p>\n    <h2 {...{\n      \"id\": \"adding-dependencies\"\n    }}>{`Adding Dependencies`}</h2>\n    <p>{`For the API calls, we'll use the `}<a href=\"https://github.com/node-fetch/node-fetch\" target=\"_new\">{`node-fetch`}</a>{` library. If you are editing the script locally, you'll need to install this package:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`npm install node-fetch\n`}</code></pre>\n    <p>{`If you are running the webhook in Glitch, you'll need to edit the `}<inlineCode parentName=\"p\">{`package.json`}</inlineCode>{` file manually and add these this package to the `}<inlineCode parentName=\"p\">{`dependencies`}</inlineCode>{` object. Take a look at the Remix link below if you need help doing this.`}</p>\n    <p>{`The header of the script also needs to be updated to include this dependency.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const fetch = require('node-fetch')\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"writing-a-generic-makeapicall-function\"\n    }}>{`Writing a Generic `}<inlineCode parentName=\"h2\">{`makeApiCall`}</inlineCode>{` function`}</h2>\n    <p>{`Making an API call to Cloud Manager requires several headers to be passed. Since we are ultimately going to be making two separate API calls (one for the execution and one for the program), it makes sense to centralize this logic into a new function.`}</p>\n    <p>{`The function itself is pretty simple -- it accepts the access token, a URL, and an HTTP method and then makes a request to that URL with the supplied method setting the three required headers:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`x-gw-ims-org-id`}</inlineCode>{` - the Organization ID (contained in the `}<inlineCode parentName=\"li\">{`ORGANIZATION_ID`}</inlineCode>{` variable)`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`x-api-key`}</inlineCode>{` - the Client ID (contained in the `}<inlineCode parentName=\"li\">{`CLIENT_ID`}</inlineCode>{` variable)`}</li>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`Authorization`}</inlineCode>{` - contains the access token`}</li>\n    </ul>\n    <p>{`The function then returns the response body as a JavaScript object.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async function makeApiCall (accessToken, url, method) {\n  const response = await fetch(url, {\n    'method': method,\n    'headers': {\n      'x-gw-ims-org-id': process.env.ORGANIZATION_ID,\n      'x-api-key': process.env.CLIENT_ID,\n      'Authorization': \\`Bearer \\${accessToken}\\`\n    }\n  })\n\n  return response.json()\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"writing-a-specific-getexecution-function\"\n    }}>{`Writing a Specific `}<inlineCode parentName=\"h2\">{`getExecution`}</inlineCode>{` Function`}</h2>\n    <p>{`With the generic function in place, the function to get an execution is pretty simple. It just needs to call the `}<inlineCode parentName=\"p\">{`getAccessToken`}</inlineCode>{` function (created in the last step) and then makes a GET request to the execution URL.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async function getExecution (executionUrl) {\n  const accessToken = await getAccessToken()\n\n  return makeApiCall(accessToken, executionUrl, 'GET')\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"getting-the-execution-in-the-webhook\"\n    }}>{`Getting the Execution in the Webhook`}</h2>\n    <p>{`Finally, we can call the `}<inlineCode parentName=\"p\">{`getExecution`}</inlineCode>{` function with the URL contained in the event payload. There's a variety of information in the execution response (take a look at the `}<a parentName=\"p\" {...{\n        \"href\": \"/cloudmanager-api-docs/reference/api/\"\n      }}>{`API Reference`}</a>{` for all the details), but for now let's just log the execution id.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`if (STARTED === event['@type'] &&\n      EXECUTION === event['xdmEventEnvelope:objectType']) {\n  console.log('received execution start event')\n\n  const executionUrl = event['activitystreams:object']['@id']\n\n  getExecution(executionUrl).then(execution => {\n    console.log(\\`Execution \\${execution.id} started\\`)\n  })\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"running-the-updated-webhook\"\n    }}>{`Running the Updated Webhook`}</h2>\n    <p>{`If you are running the script locally, you'll need to stop and restart the node process. You don't need to restart ngrok. In fact, if you do restart ngrok, the URL will likely change and you'll need to go back into the `}<a href=\"https://developer.adobe.com/console/projects\" target=\"_new\">{`Adobe Developer Console`}</a>{` and update the Webhook URL.`}</p>\n    <p>{`If you are running the script through Glitch, Glitch will restart automatically. If you don't want to update your existing Glitch project (or lost it), you can click the button below to start over.`}</p>\n    <Glitch projectName=\"adobe-cloudmanager-api-tutorial-step5\" mdxType=\"Glitch\" />\n    <h2 {...{\n      \"id\": \"next-step\"\n    }}>{`Next Step`}</h2>\n    <p>{`With all that done, you're ready to proceed to the next step. Continue to `}<a parentName=\"p\" {...{\n        \"href\": \"6-getting-the-program.md\"\n      }}>{`Step 6`}</a>{`.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","href","target","parentName","projectName","isMDXComponent"],"sourceRoot":""}