{"version":3,"file":"component---src-pages-tutorial-6-getting-the-program-md-d3c5c5ab9914ca0550a9.js","mappings":"0SASaA,EAAe,GACtBC,EAAc,CAClBD,aAAAA,GAEIE,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAI5E,eACE,GAAM,kDADR,mDAGA,2RAA4Q,uBAAYC,WAAW,KAAvB,4BAA5Q,MACA,wMAAyL,cAAGC,KAAK,+DAA+DC,OAAO,QAA9E,kCAAzL,2KAA+d,uBAAYF,WAAW,KAAvB,UAA/d,iJAAkqB,uBAAYA,WAAW,KAAvB,QAAlqB,iDACA,gFACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,gdAiBL,4BACE,cAAGA,WAAW,cAAd,iFAA4G,uBAAYA,WAAW,KAAvB,eAA5G,aAAgL,uBAAYA,WAAW,KAAvB,QAAhL,0FAEF,gDAAiC,eAAIA,WAAW,KAAf,YAAjC,+EAAoJ,uBAAYA,WAAW,KAAvB,yBAApJ,qFACA,eACE,GAAM,sCADR,sBAEyB,uBAAYA,WAAW,MAAvB,WAFzB,cAGA,2QACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,oFAML,eACE,GAAM,oCADR,iBAEoB,uBAAYA,WAAW,MAAvB,gBAFpB,YAGA,gOAAiN,uBAAYA,WAAW,KAAvB,OAAjN,2EAA2U,uBAAYA,WAAW,KAAvB,eAA3U,oGACA,mCAAoB,uBAAYA,WAAW,KAAvB,OAApB,wEAA2I,uBAAYA,WAAW,KAAvB,OAA3I,+CAAyO,uBAAYA,WAAW,KAAvB,mBAAzO,yFACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,wDAIL,kCAAmB,uBAAYA,WAAW,KAAvB,gBAAnB,+BACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,keAiBL,eACE,GAAM,2CADR,4CAGA,+BAAgB,uBAAYA,WAAW,KAAvB,gBAAhB,oDAA4H,uBAAYA,WAAW,KAAvB,aAA5H,0GACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,iWAeL,eACE,GAAM,+BADR,gCAGA,iPAAkO,cAAGC,KAAK,+CAA+CC,OAAO,QAA9D,2BAAlO,iCACA,4NACA,SAAC,IAAD,CAAQC,YAAY,wCAAwCJ,QAAQ,YACpE,eACE,GAAM,aADR,cAGA,0GAA2F,cAAGC,WAAW,IACrG,KAAQ,8BAD+E,UAA3F,MAOJJ,EAAWQ,gBAAiB","sources":["webpack://cloudmanager-api-docs/./src/pages/tutorial/6-getting-the-program.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/cloudmanager-api-docs/cloudmanager-api-docs/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nimport Glitch from \"../../components/glitch\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <h1 {...{\n      \"id\": \"tutorial-step-6---navigating-between-api-calls\"\n    }}>{`Tutorial Step 6 - Navigating Between API Calls`}</h1>\n    <p>{`While the execution information is interesting, what we actually want to send in the notification sent to Microsoft Teams or Slack is the program name. This isn't in the execution response but has to be requested from a different URL, one following the pattern `}<inlineCode parentName=\"p\">{`/api/program/{programId}`}</inlineCode>{`.`}</p>\n    <p>{`While it is possible for you to formulate the URL, it is a best practice to follow the links provided in the API response. The Cloud Manager API responses use a convention named `}<a href=\"https://en.wikipedia.org/wiki/Hypertext_Application_Language\" target=\"_new\">{`Hypertext Application Language`}</a>{` (HAL for short) to define links. But you don't really need to know too many details of HAL to use the API. The important part is that in the API response, there is a `}<inlineCode parentName=\"p\">{`_links`}</inlineCode>{` object which contains a set of objects. Each of these objects has a meaningful name that tells the API consumer where the link goes and the `}<inlineCode parentName=\"p\">{`href`}</inlineCode>{` property of the object has the destination.`}</p>\n    <p>{`For example, in an execution response, you will see this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`    \"_links\": {\n        \"http://ns.adobe.com/adobecloud/rel/pipeline\": {\n            \"href\": \"/api/program/1234/pipeline/5678\",\n            \"templated\": false\n        },\n        \"http://ns.adobe.com/adobecloud/rel/program\": {\n            \"href\": \"/api/program/1234\",\n            \"templated\": false\n        },\n        \"self\": {\n            \"href\": \"/api/program/1234/pipeline/5678/execution/9012\",\n            \"templated\": false\n        }\n    }\n`}</code></pre>\n    <blockquote>\n      <p parentName=\"blockquote\">{`The Cloud Manager API uses templatized links in a few places; in these cases `}<inlineCode parentName=\"p\">{`templatized`}</inlineCode>{` will be `}<inlineCode parentName=\"p\">{`true`}</inlineCode>{`, but that's not the case for the program links we need to follow for this tutorial.`}</p>\n    </blockquote>\n    <p>{`Note that these links are `}<em parentName=\"p\">{`relative`}</em>{` to the domain name for the API. As with the path, while you could prepend `}<inlineCode parentName=\"p\">{`cloudmanager.adobe.io`}</inlineCode>{` yourself, it is a best practice to have the links be treated as relative links.`}</p>\n    <h2 {...{\n      \"id\": \"writing-a-generic-getlink-function\"\n    }}>{`Writing a Generic `}<inlineCode parentName=\"h2\">{`getLink`}</inlineCode>{` Function`}</h2>\n    <p>{`This might be overkill for this tutorial, since we only need a single link, but getting a link from an API response is a common enough task that it makes sense to make a separate function for this. It's fairly straightforward object navigation:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`function getLink(obj, linkType) {\n  return obj[\"_links\"][linkType].href;\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"updating-the-getexecution-method\"\n    }}>{`Updating the `}<inlineCode parentName=\"h2\">{`getExecution`}</inlineCode>{` Method`}</h2>\n    <p>{`To get the program data based on the execution, first you get the link to the program from the execution response. Remember -- at this point it will be a server-relative path. Then, you use the Node.js `}<inlineCode parentName=\"p\">{`URL`}</inlineCode>{` class to turn that path into an absolute URL and pass this URL to the `}<inlineCode parentName=\"p\">{`makeApiCall`}</inlineCode>{` function to get the program. Finally, the program response is added to the execution response.`}</p>\n    <p>{`Although the `}<inlineCode parentName=\"p\">{`URL`}</inlineCode>{` class is built-in to Node.js, it does need to be imported from the `}<inlineCode parentName=\"p\">{`url`}</inlineCode>{` module. We already are doing this for the `}<inlineCode parentName=\"p\">{`URLSearchParams`}</inlineCode>{` class (added in Step 4), so that line can simply be updated to import both classes.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const { URLSearchParams, URL } = require(\"url\");\n`}</code></pre>\n    <p>{`The updated `}<inlineCode parentName=\"p\">{`getExecution`}</inlineCode>{` function looks like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`async function getExecution(executionUrl) {\n  const accessToken = await getAccessToken();\n\n  const execution = await makeApiCall(accessToken, executionUrl, \"GET\");\n\n  const REL_PROGRAM = \"http://ns.adobe.com/adobecloud/rel/program\";\n  const programLink = getLink(execution, REL_PROGRAM);\n  const programUrl = new URL(programLink, executionUrl);\n  const program = await makeApiCall(accessToken, programUrl);\n\n  execution.program = program;\n\n  return execution;\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"logging-the-program-name-in-the-webhook\"\n    }}>{`Logging the Program Name in the Webhook`}</h2>\n    <p>{`Now that `}<inlineCode parentName=\"p\">{`getExecution`}</inlineCode>{` returns the Program information as part of the `}<inlineCode parentName=\"p\">{`execution`}</inlineCode>{` object, we can easily change the log message to output the program name instead of the execution id.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`if (\n  STARTED === event[\"@type\"] &&\n  EXECUTION === event[\"xdmEventEnvelope:objectType\"]\n) {\n  console.log(\"received execution start event\");\n\n  const executionUrl = event[\"activitystreams:object\"][\"@id\"];\n\n  getExecution(executionUrl).then((execution) => {\n    console.log(\\`Execution for \\${execution.program.name} started\\`);\n  });\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"running-the-updated-webhook\"\n    }}>{`Running the Updated Webhook`}</h2>\n    <p>{`If you are running the script locally, you'll need to stop and restart the node process. You don't need to restart ngrok. In fact, if you do restart ngrok, the URL will likely change and you'll need to go back into the `}<a href=\"https://developer.adobe.com/console/projects\" target=\"_new\">{`Adobe Developer Console`}</a>{` and update the Webhook URL.`}</p>\n    <p>{`If you are running the script through Glitch, Glitch will restart automatically. If you don't want to update your existing Glitch project (or lost it), you can click the button below to start over.`}</p>\n    <Glitch projectName=\"adobe-cloudmanager-api-tutorial-step6\" mdxType=\"Glitch\" />\n    <h2 {...{\n      \"id\": \"next-step\"\n    }}>{`Next Step`}</h2>\n    <p>{`With all that done, you're ready to proceed to the next and final step. Continue to `}<a parentName=\"p\" {...{\n        \"href\": \"7-sending-notifications.md\"\n      }}>{`Step 7`}</a>{`.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","href","target","projectName","isMDXComponent"],"sourceRoot":""}